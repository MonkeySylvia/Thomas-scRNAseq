#combine TE and gene 
cat /workdir/nc499/reference/dr11_ref/Danio_rerio.GRCz11.intactgenename.gtf /workdir/nc499/quirze/danRer11.TEtrans_uID.subClass.wredundant.annot_categ.PCg.dfrag.c2.Rt.cluster.gtf | sort -k1,1 -k2,2n > danRer11.gene.allTES_110821.gtf

#this is the final file
sed -i 's/chrMT/chrM/g' danRer11.gene.allTES_110821.gtf
sed 's/CDS/exon/' danRer11.gene.allTES_110821.gtf > danRer11.gene.allTES_exon_110821.gtf



#create a gfp reference
vim gfp.fa
ATGGTGAGCAAGGGCGAGGAGCTGTTCACCGGGGTGGTGCCCATCCTGGTCGAGCTGGACGGCGACGTAAACGGCCACAA
GTTCAGCGTGTCCGGCGAGGGCGAGGGCGATGCCACCTACGGCAAGCTGACCCTGAAGTTCATCTGCACCACCGGCAAGC
TGCCCGTGCCCTGGCCCACCCTCGTGACCACCCTGACCTACGGCGTGCAGTGCTTCAGCCGCTACCCCGACCACATGAAG
CAGCACGACTTCTTCAAGTCCGCCATGCCCGAAGGCTACGTCCAGGAGCGCACCATCTTCTTCAAGGACGACGGCAACTA
CAAGACCCGCGCCGAGGTGAAGTTCGAGGGCGACACCCTGGTGAACCGCATCGAGCTGAAGGGCATCGACTTCAAGGAGG
ACGGCAACATCCTGGGGCACAAGCTGGAGTACAACTACAACAGCCACAACGTCTATATCATGGCCGACAAGCAGAAGAAC
GGCATCAAGGTGAACTTCAAGATCCGCCACAACATCGAGGACGGCAGCGTGCAGCTCGCCGACCACTACCAGCAGAACAC
CCCCATCGGCGACGGCCCCGTGCTGCTGCCCGACAACCACTACCTGAGCACCCAGTCCGCCCTGAGCAAAGACCCCAACG
AGAAGCGCGATCACATGGTCCTGCTGGAGTTCGTGACCGCCGCCGGGATCACTCTCGGCATGGACGAGCTGTACAAGTAA

cat gfp.fa | grep -v "^>" | tr -d "\n" | wc -c
720

echo -e 'GFP\tunknown\texon\t1\t720\t.\t+\t.\tgene_id "GFP"; transcript_id "GFP"; gene_name "GFP"; gene_biotype "protein_coding";' > GFP.gtf

cp danRer11.nonalt.fa danRer11.nonalt.GFP.fa 

cat gfp.fa >> danRer11.nonalt.GFP.fa

#check
grep ">" danRer11.nonalt.GFP.fa

#create a gtf

cp danRer11.gene.allTES_exon_110821.gtf danRer11.gene.allTES_exon_110821_GFP.gtf
cat GFP.gtf >> danRer11.gene.allTES_exon_110821_GFP.gtf



#create a reference file from dr11+GFP -> for STAR alignment
#genome file= danRer11.nonalt.fa
#danRer11.nonalt.GFP.fa= danRer11.nonalt.fa+ gfp.fa

/programs/STAR-2.7.9a/bin/Linux_x86_64_static/STAR \
--runMode genomeGenerate \
--runThreadN 10 \
--genomeDir /workdir/nc499/reference/STAR_GFP \
--genomeFastaFiles /workdir/nc499/reference/danRer11.nonalt.GFP.fa &

#create a reference file for consensus
#consensus file = /workdir/nc499/reference/consensus/zebrep.fa
/programs/STAR-2.7.9a/bin/Linux_x86_64_static/STAR \
--runMode genomeGenerate \
--runThreadN 10 \
--genomeDir /workdir/nc499/reference/STAR_consensus \
--genomeFastaFiles /workdir/nc499/reference/consensus/zebrep.fa &

####
###create a reference file with name of full-length L2 (111921)
#total L2 loci number
grep 'L2-2_DRe' /workdir/nc499/reference/danRer11.gene.allTES_exon_110821_GFP.gtf | wc
   7784  420336 4603990

grep -v 'L2-2_DRe' /workdir/nc499/reference/danRer11.gene.allTES_exon_110821_GFP.gtf | wc
4954517 247987627 2815279837

wc /workdir/nc499/reference/danRer11.gene.allTES_exon_110821_GFP.gtf
   4962301

#create L2/non-L2 gtf
grep -v 'L2-2_DRe' /workdir/nc499/reference/danRer11.gene.allTES_exon_110821_GFP.gtf > danRer11.gene.allTES_exon_110821_GFP_noL2.gtf
grep 'L2-2_DRe' /workdir/nc499/reference/danRer11.gene.allTES_exon_110821_GFP.gtf > L2.gtf

creat intact_L2.txt from Jons annotation

grep -wf intact_L2.txt L2.gtf | sed 's/L2-2_DRe/L2-2_DRe_full/' > intact_L2_rename.gtf

grep -wvf intact_L2.txt L2.gtf | wc
   7702

wc L2.gtf
   7784

grep -wvf intact_L2.txt L2.gtf > not_intact_L2.gtf

cat intact_L2_rename.gtf not_intact_L2.gtf | sort -k1,1 -k2,2n > L2_rename.gtf

wc L2_rename.gtf
   7784

#coombine non-L2 and L2_renamed

grep 'L2-2_DRe_full' L2_rename.gtf | wc

cat danRer11.gene.allTES_exon_110821_GFP_noL2.gtf L2_rename.gtf | sort -k1,1 -k2,2n > danRer11.gene.allTES_exon_110821_GFP_renameL2.gtf

#sanity check
wc danRer11.gene.allTES_exon_110821_GFP_renameL2.gtf
   4962301

grep 'L2-2_DRe_full' danRer11.gene.allTES_exon_110821_GFP_renameL2.gtf | wc
     82    4428   48871
grep 'L2-2_DRe' danRer11.gene.allTES_exon_110821_GFP_renameL2.gtf | wc
   7784  420336 4604400
grep -w 'L2-2_DRe' danRer11.gene.allTES_exon_110821_GFP_renameL2.gtf | wc
   7702  415908 4555529

   
mv danRer11.gene.allTES_exon_110821_GFP_renameL2.gtf /workdir/nc499/reference/














